-- View: doc_orders_shipment_dialog--DROP VIEW doc_orders_shipment_dialog;CREATE OR REPLACE VIEW doc_orders_shipment_dialog AS 	/*	ttn_data AS (		SELECT			t_cl.ext_id AS carrier_ref,			t_dr.ext_id AS driver_ref,			t_dr.name AS driver_name,			t_dr.drive_perm AS driver_drive_perm,			t_dr.cel_phone AS driver_cel_phone,			t_vh.model AS vh_model,			t_vh.plate AS vh_plate,			t_vh.load_weight_t AS vh_load_weight_t,			t_vh.vol AS vh_vol,			t_vh.trailer_plate AS vh_trailer_plate,			t_vh.trailer_model As vh_trailer_model		FROM carrier_orders t		LEFT JOIN carriers AS t_cr ON t_cr.id=t.carrier_id		LEFT JOIN clients AS t_cl ON t_cl.id=t_cr.client_id		LEFT JOIN drivers AS t_dr ON t_dr.id=t.driver_id		LEFT JOIN vehicles AS t_vh ON t_vh.id=t.vehicle_id		WHERE t.ord=carrier_orders_today_ord(now()::timestamp without time zone)	)	*/	SELECT		d.id,						d.date_time,		date8_time5_descr(d.date_time) AS date_time_descr,				d.number,		d.processed,				d.client_id,		cl.name AS client_descr,		cl.pay_type,				d.deliv_vehicle_count,				dr.id AS driver_id,		dr.name AS driver_name,		d.deliv_type,				vh.id AS vehicle_id,		vh.plate||coalesce(' '||dr.name,'') AS vehicle_descr,		d.destination_to_ttn,				d.deliv_destination_id AS deliv_destination_id,		cl_d.value AS deliv_destination_descr,				/*		CASE			WHEN ttn_pairs.firm_id IS NOT NULL THEN (SELECT ttn_data.driver_ref FROM ttn_data)			ELSE dr.ext_id		END AS driver_ref,		CASE			WHEN ttn_pairs.firm_id IS NOT NULL THEN (SELECT ttn_data.driver_name FROM ttn_data)			ELSE dr.name		END AS driver_name,		*/		d.batch_num					FROM doc_orders AS d	LEFT JOIN clients AS cl ON cl.id=d.client_id	LEFT JOIN users AS u ON u.id=d.user_id	--LEFT JOIN deliveries dlv ON dlv.doc_order_id=d.id	LEFT JOIN vehicles vh ON vh.id=d.vehicle_id	LEFT JOIN drivers dr ON dr.id=vh.driver_id	LEFT JOIN client_destinations cl_d ON cl_d.id=d.deliv_destination_id	;ALTER TABLE doc_orders_shipment_dialog OWNER TO polimerplast;