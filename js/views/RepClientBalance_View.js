/* Copyright (c) 2012 	Andrey Mikhalevich, Katren ltd.*//*		Description*///ф/** Requirements * @requires controls/ViewList.js*//* constructor */function RepClientBalance_View(id,options){	options = options || {};		options.noOk = true;	options.noCancel = true;		RepClientBalance_View.superclass.constructor.call(this,		id,options);		var cont=new ControlContainer(id+"_cont","fieldset");		var model_id = "_Model";		this.m_periodCtrl = new PeriodFilter(id+"_period",{		"period":"quater",		"valueFieldId":"date"	});	cont.addElement(this.m_periodCtrl);		var bs_col = get_bs_col();		this.m_firmCtrl = new FirmEditObject(		"firm_id",id+"_firm",false,null,{			"attrs":{"required":"required"},			"editContClassName":"input-group "+bs_col+"2",			"labelClassName":"control-label "+bs_col+"1"		});	cont.addElement(this.m_firmCtrl,		{"modelId":model_id,		"valueFieldId":"firm_id",		"keyFieldIds":null},		{"valueFieldId":"firm_id","keyFieldIds":null}	);	var self = this;	cont.addElement(new ButtonCmd(id+"_submit",				{"caption":"Акт сверки (pdf)",		"onClick":function(){			self.submit("pdf");		},		"attrs":{"title":"сформировать акт сверки в формате pdf"}	}));		cont.addElement(new ButtonCmd(id+"_submit_xls",				{"caption":"Акт сверки (excel)",		"onClick":function(){			self.submit("xls");		},		"attrs":{"title":"сформировать акт сверки в формате excel"}	}));		this.addControl(cont);}extend(RepClientBalance_View,ViewDialog);RepClientBalance_View.prototype.submit = function(file_type){	this.m_firmCtrl.setComment("");	this.getErrorControl().setValue("");	var firm_id = this.m_firmCtrl.getFieldValue();	if (!firm_id||firm_id=="undefined"){		this.m_firmCtrl.setComment("Не выбрана фирма!");		this.getErrorControl().setValue("Не выбрана фирма!");		return;	}		var contr = new Report_Controller(new ServConnector(HOST_NAME));	var meth_id = "client_balance";	var checkRes = {incorrect_vals:false,modif:false};	var pm = contr.getPublicMethodById(meth_id);	this.setMethodParams(pm,checkRes);	pm.setParamValue("firm_id",firm_id);	pm.setParamValue("date_from",DateHandler.dateToStr(this.m_periodCtrl.getDateFrom(),"dd/mm/y"));	pm.setParamValue("date_to",DateHandler.dateToStr(this.m_periodCtrl.getDateTo(),"dd/mm/y"));	pm.setParamValue("file_type",file_type);		if (!checkRes.incorrect_vals){		top.location.href = HOST_NAME+"index.php?"+contr.getQueryString(pm);	}	else if (checkRes.incorrect_vals){		//this.m_errorControl.setValue("Обнаружены ошибки!");	}	else if (!checkRes.modif){		this.onWriteOk();	}}